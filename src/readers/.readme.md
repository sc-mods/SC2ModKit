# SC2 Readers Library

This library provides multiple `Reader` implementations for loading mod/game data from various sources such as IndexedDB, LevelDB, Web File System, GitHub, URLs, and ZIP archives. Each reader extends a common base `Reader` class, offering consistent async methods to **list**, **get**, **set**, **delete**, and **clear** files.

---

## Available Readers

### 1. IDBReader (IndexedDB)

An async reader for the browser's IndexedDB API.

- Stores data in a specified IndexedDB database and object store.
- Supports key namespacing with optional `modName` prefix.
- Methods:  
  - `init(modName?)` — initializes DB connection.  
  - `list(prefix?)` — lists stored keys matching prefix.  
  - `get(filename)` — reads file content.  
  - `set(filename, value)` — writes file content.  
  - `delete(filename)` — deletes a file.  
  - `clear()` — clears all or mod-prefixed keys.

---

### 2. LevelDBReader

A Node.js LevelDB reader (uses [level](https://github.com/Level/level)).

- Similar API to IDBReader for local persistent storage.
- Methods:  
  - `init(modName?)`  
  - `list(prefix?)`  
  - `get(filename)`  
  - `set(filename, value)`  
  - `delete(filename)`  
  - `clear()`  
  - `close()` — closes the DB connection.

---

### 3. WebReader

Reads from browser's File System Access API directory handle.

- Works with a directory handle selected via directory picker or passed in constructor.
- Recursively lists files and folders.
- Reads and writes files directly.
- Methods:  
  - `init()` — prompts for directory if not provided.  
  - `list(prefix?)` — recursively lists files.  
  - `get(filePath, format?)` — reads file as text, buffer, or base64.  
  - `set(filePath, content)` — writes file.  
  - `link(filePath)` — returns logical path.  
  - Optionally add `close()` if needed.

---

### 4. GitReader

Reads files from a GitHub repository via the GitHub REST API.

- Supports GitHub Personal Access Token for authentication.
- Uses the old `getContent` method for repositories with fewer than 1000 files (recommended).
- Falls back to the newer Git Tree API for larger repos.
- Methods:  
  - `init(modpath)` — parse repo owner, name, and path.  
  - `list()` — lists files in the repo path.  
  - `get(filename)` — fetches file content.  
  - `getFiles(dirPath, recursive)` — legacy method for listing files/folders recursively.

**How to get a GitHub token:**  
1. Log in to GitHub.  
2. Go to **Settings → Developer Settings → Personal Access Tokens → Tokens (classic)**.  
3. Generate new token with scopes: `repo` (or `public_repo` for public repos).  
4. Copy token securely (it won't be shown again).  

---

### 5. URLReader

Fetches files from a remote URL base path.

- Requires an `index.json` file hosted at the base URL listing files and folders, e.g.:

  ```json  
  {  
    "files": ["data/mod.json", "data/units/unit1.json"],  
    "folders": ["data", "data/units"]  
  }  
  ```

- Methods:  
  - `init(modpath)` — sets the base URL and index filename.  
  - `list(dirPath?)` — lists files and folders filtered by directory.  
  - `get(relativeFile)` — fetches a file as text.  
  - `set(relativeFile, content)` — sends a POST request to upload content (if supported).

---

### 6. ZipReader

Reads and writes files inside a ZIP archive using JSZip.

- Load ZIP file or create empty archive.
- List files in archive optionally filtered by directory prefix.
- Read file contents as text.
- Write/update files inside ZIP.
- Export updated ZIP as Blob.
- Methods:  
  - `init()` — loads or creates ZIP archive.  
  - `list(dirPath?)` — lists files in ZIP starting with dirPath.  
  - `get(path)` — reads file content as text.  
  - `set(filename, content)` — writes or updates a file.  
  - `blob()` — exports ZIP archive as Blob.

---

# Usage Example

```js
import { IDBReader } from './readers/idb-reader.js';
import LevelDBReader from './readers/leveldb-reader.js';
import WebReader from './readers/web-reader.js';
import { GitReader } from './readers/git-reader.js';
import URLReader from './readers/url-reader.js';
import ZipReader from './readers/zip-reader.js';


Initialize and use any reader with:
await reader.init(modNameOrPath);
const files = await reader.list();
const content = await reader.get('filename');
await reader.set('filename', 'content');
```

## Notes

All readers extend a base Reader class which defines core methods and options.

Authentication tokens (e.g., GitHub Personal Access Token) should be kept secure and passed in options.

For URLReader, hosting an up-to-date index.json file listing files and folders is required.

WebReader requires browser support for the File System Access API.

LevelDBReader requires a Node.js environment.

ZipReader supports reading and modifying ZIP archives entirely in-memory.

